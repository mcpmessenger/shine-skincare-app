version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - echo "Setting production environment variables..."
        - echo "Removing development environment file..."
        - rm -f .env.local
        - echo "Creating production environment file..."
        - echo "# Production Environment Variables" > .env.production
        - echo "NEXT_PUBLIC_BACKEND_URL=https://api.shineskincollective.com" >> .env.production
        - echo "NODE_ENV=production" >> .env.production
        - echo "NEXT_PUBLIC_IS_LOCAL_DEV=false" >> .env.production
        - echo "NEXT_PUBLIC_VERCEL_URL=https://shineskincollective.com" >> .env.production
        - echo "Verifying environment variables..."
        - cat .env.production
        - npm run build
        - echo "Build completed successfully"
        - echo "Verifying file structure..."
        - ls -la
        - echo "Checking public folder contents..."
        - ls -la public/
        - echo "Checking .next folder contents..."
        - ls -la .next/
  artifacts:
    baseDirectory: .
    files:
      - .next/**/*
      - public/**/*
      - package.json
      - next.config.mjs
      - node_modules/**/*
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
