option_settings:
  aws:elasticbeanstalk:application:environment:
    # Core application settings
    FLASK_APP: "run.py"
    FLASK_ENV: "production"
    PYTHONPATH: "/var/app/current"
    PORT: "5000"
    
    # ML Service Configuration
    USE_MOCK_SERVICES: "false"
    USE_PRODUCTION_FAISS: "true"
    GOOGLE_VISION_ENABLED: "true"
    FAISS_PERSISTENCE_ENABLED: "true"
    
    # FAISS Configuration
    FAISS_DIMENSION: "2048"
    FAISS_INDEX_PATH: "/var/app/current/faiss_data/faiss_index"
    FAISS_BATCH_SIZE: "1000"
    FAISS_SEARCH_TIMEOUT: "30"
    
    # Demographic Search Configuration
    DEMOGRAPHIC_WEIGHT: "0.3"
    ETHNICITY_WEIGHT: "0.6"
    SKIN_TYPE_WEIGHT: "0.3"
    AGE_GROUP_WEIGHT: "0.1"
    
    # Classification Configuration
    CLASSIFICATION_CONFIDENCE_THRESHOLD: "0.7"
    SKIN_ANALYSIS_TIMEOUT: "60"
    
    # Google Cloud Configuration
    GOOGLE_APPLICATION_CREDENTIALS: "/var/app/current/google-credentials.json"
    GOOGLE_CLOUD_PROJECT: "shine-466907"
    
    # Database Configuration
    DATABASE_POOL_SIZE: "10"
    DATABASE_TIMEOUT: "30"
    
    # Logging Configuration
    LOG_LEVEL: "INFO"
    LOG_FILE: "/var/app/current/logs/application.log"
    LOG_MAX_SIZE: "100MB"
    LOG_BACKUP_COUNT: "5"
    
    # Performance Configuration
    GUNICORN_WORKERS: "4"
    GUNICORN_THREADS: "15"
    GUNICORN_TIMEOUT: "300"
    GUNICORN_KEEPALIVE: "5"
    GUNICORN_MAX_REQUESTS: "1000"
    GUNICORN_MAX_REQUESTS_JITTER: "100"
    GUNICORN_PRELOAD: "true"
    
    # Memory Management
    PYTHON_GC_THRESHOLD: "700,10,10"
    OMP_NUM_THREADS: "4"
    MKL_NUM_THREADS: "4"
    OPENBLAS_NUM_THREADS: "4"
    NUMEXPR_MAX_THREADS: "4"
    
    # ML Model Configuration
    MODEL_CACHE_SIZE: "1000"
    MODEL_LAZY_LOADING: "true"
    VECTOR_CACHE_SIZE: "10000"
    
    # Security Configuration
    SECRET_KEY_PARAM: "/shine/prod/secret-key"
    SUPABASE_URL_PARAM: "/shine/prod/supabase-url"
    SUPABASE_KEY_PARAM: "/shine/prod/supabase-key"
    
    # Health Check Configuration
    HEALTH_CHECK_TIMEOUT: "10"
    STARTUP_TIMEOUT: "180"

files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/01-app-logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/app/current/logs/application.log
      /var/log/eb-engine.log
      /var/log/eb-hooks.log

  "/opt/elasticbeanstalk/tasks/bundlelogs.d/01-app-logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/app/current/logs/application.log
      /var/log/eb-engine.log
      /var/log/eb-hooks.log

  "/opt/elasticbeanstalk/tasks/systemtaillogs.d/01-app-logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/app/current/logs/application.log